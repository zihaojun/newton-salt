[mysqld]
server_id={{ ID }}
bind_address = {{ HOSTNAME }} 
datadir=/var/lib/mysql
#log-error=/var/log/mariadb/mariadb.log
collation-server = utf8_general_ci
init-connect = 'SET NAMES utf8'
character-set-server = utf8
skip-name-resolve

default-storage-engine = innodb
innodb_file_per_table = 1
innodb_buffer_pool_size = 512M
tmp_table_size = 256M
innodb_autoinc_lock_mode=2
innodb_doublewrite=1
innodb_locks_unsafe_for_binlog=1
innodb_flush_log_at_trx_commit=0
innodb_open_files = 500
innodb_write_io_threads = 4
innodb_read_io_threads = 4
innodb_thread_concurrency = 0
innodb_purge_threads = 1
#innodb_log_buffer_size = 2M
#innodb_log_file_size = 32M
#innodb_log_files_in_group = 3
innodb_max_dirty_pages_pct = 90
innodb_lock_wait_timeout = 120

binlog_format = ROW

open_files_limit = 65535
max_connections = 1024
max_allowed_packet = 4M
max_heap_table_size = 8M
max_connections = 4096
tmp_table_size = 16M
read_buffer_size = 2M
read_rnd_buffer_size = 8M
sort_buffer_size = 8M
join_buffer_size = 8M
thread_cache_size = 64
query_cache_size = 0   
query_cache_type = 0   
interactive_timeout = 28800
wait_timeout = 28800

wsrep_provider=/usr/lib64/galera/libgalera_smm.so
wsrep_provider_options="pc.ignore_quorum = true; pc.ignore_sb=false; gmcast.listen_addr=tcp://{{HOSTNAME}}:4567;gcs.fc_limit = 256; gcs.fc_factor = 0.99; gcs.fc_master_slave=yes"
{% if MASTER_ENABLED -%}
wsrep_cluster_address=gcomm://
{% else %}
wsrep_cluster_address=gcomm://{{ MASTER }}
{% endif %}
wsrep_cluster_name='openstack-controller'
wsrep_node_address='{{HOSTNAME}}'
wsrep_node_name='mysql-galera-{{HOSTNAME}}'
wsrep_sst_method=rsync
wsrep_sst_auth={{SST_USER}}:{{SST_PASS}}
wsrep_slave_threads=16

