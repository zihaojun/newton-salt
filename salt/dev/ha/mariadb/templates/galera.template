#!/bin/bash
# function: mariadb galera cluster start/stop script.
# author: ice
# email: yao3690093@gmail.com
# chkconfig: 2345 64 36
# description: A very fast and reliable SQL database engine.

# Comments to support LSB init script conventions
### BEGIN INIT INFO
# Provides: mysql
# Required-Start: $local_fs $network $remote_fs
# Should-Start: ypbind nscd ldap ntpd xntpd
# Required-Stop: $local_fs $network $remote_fs
# Default-Start:  2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: start and stop MySQL
# Description: MySQL is a very fast and reliable SQL database engine.
### END INIT INFO

if [ $1 = 'start' ];then
/usr/bin/mysql -u{{ SST_USER }} -p{{ SST_PASS }} -h {{ HOSTNAME }} -e 'use test' &> /dev/null
	if [ $? -ne 0 ];then
		mode='bootstrap'
	else
		mode=$1
	fi
else
   mode=$1
fi

case "$mode" in
	'start')
      service mysql start
       ;;

	'stop')
      service mysql stop
       ;;

	'restart')
	  service mysql restart
       ;;

	'status')
	  service mysql status
	   ;;

   'bootstrap')
      service mysql bootstrap
	   ;;
esac
